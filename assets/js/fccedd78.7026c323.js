"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[859],{1184:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var i=o(4041);const r={},t=i.createContext(r);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(t.Provider,{value:n},e.children)}},4940:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"deployment/portal/deploying_on_non_root","title":"Deploying on Non-Root URLs","description":"This guide provides instructions for deploying the DHIS2 Public Portal on a non-root URL path (e.g., example.com/portal","source":"@site/docs/deployment/portal/deploying_on_non_root.md","sourceDirName":"deployment/portal","slug":"/deployment/portal/deploying_on_non_root","permalink":"/dhis2-public-portal/docs/deployment/portal/deploying_on_non_root","draft":false,"unlisted":false,"editUrl":"https://github.com/hisptz/dhis2-public-portal/tree/main/apps/docs/docs/deployment/portal/deploying_on_non_root.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"deploySidebar","previous":{"title":"Deploying to Vercel","permalink":"/dhis2-public-portal/docs/deployment/portal/deploy_to_vercel"},"next":{"title":"Portal Manager Deployment","permalink":"/dhis2-public-portal/docs/deployment/portal_manager/"}}');var r=o(1085),t=o(1184);const s={sidebar_position:3},l="Deploying on Non-Root URLs",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Configuration Steps",id:"configuration-steps",level:2},{value:"1. Clone the repository",id:"1-clone-the-repository",level:3},{value:"2. Set the Base Path",id:"2-set-the-base-path",level:3},{value:"3. Building a custom docker image",id:"3-building-a-custom-docker-image",level:3},{value:"4. Reverse Proxy Configuration",id:"4-reverse-proxy-configuration",level:3},{value:"Nginx Example",id:"nginx-example",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Limitations",id:"limitations",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"deploying-on-non-root-urls",children:"Deploying on Non-Root URLs"})}),"\n",(0,r.jsx)(n.p,{children:"This guide provides instructions for deploying the DHIS2 Public Portal on a non-root URL path (e.g., example.com/portal\ninstead of example.com)."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"By default, the DHIS2 Public Portal is configured to run at the root of a domain. However, in some environments, you may\nneed to deploy it under a specific path. This requires additional configuration to ensure all assets, links, and API\ncalls work correctly. You will need to manually build the portal application before deployment"}),"\n",(0,r.jsx)(n.h2,{id:"configuration-steps",children:"Configuration Steps"}),"\n",(0,r.jsx)(n.h3,{id:"1-clone-the-repository",children:"1. Clone the repository"}),"\n",(0,r.jsx)(n.p,{children:"You need to clone the repository to your server by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone --single-branch --branch main https://github.com/hisptz/dhis2-public-portal.git\ncd dhis2-public-portal\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-set-the-base-path",children:"2. Set the Base Path"}),"\n",(0,r.jsxs)(n.p,{children:["The most important configuration is setting the ",(0,r.jsx)(n.code,{children:"CONTEXT_PATH"})," environment variable."]}),"\n",(0,r.jsxs)(n.p,{children:["Create the ",(0,r.jsx)(n.code,{children:".env"})," file in the ",(0,r.jsx)(n.code,{children:"apps/portal/"})," folder. The file should have the following variables:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DHIS2_BASE_URL"}),": The URL of your DHIS2 instance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DHIS2_BASE_PAT_TOKEN"}),": A Personal Access Token for your DHIS2 instance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CONTEXT_PATH"}),": A subpath where your application will be hosted (e.g ",(0,r.jsx)(n.code,{children:"/portal"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This tells the Next.js application to use ",(0,r.jsx)(n.code,{children:"/portal"})," as the base path for all assets and navigation."]}),"\n",(0,r.jsx)(n.h3,{id:"3-building-a-custom-docker-image",children:"3. Building a custom docker image"}),"\n",(0,r.jsx)(n.p,{children:"You can then build your custom docker image by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker build -t portal:latest . \n"})}),"\n",(0,r.jsx)(n.p,{children:"And then run the created docker image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -p 3000:3000 -e DHIS2_BASE_URL=https://your-dhis2-instance.org portal:latest\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also use the ",(0,r.jsx)(n.code,{children:"docker-comopse-build.yml"})," file provided to build and run the application using docker compose:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:" docker compose -f docker-compose-build.yml up -d --build \n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-reverse-proxy-configuration",children:"4. Reverse Proxy Configuration"}),"\n",(0,r.jsx)(n.p,{children:"When using a reverse proxy like Nginx, you need to configure it to properly handle the base path:"}),"\n",(0,r.jsx)(n.h4,{id:"nginx-example",children:"Nginx Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name example.com;\n\n    location /portal {\n        proxy_pass http://localhost:3000/portal;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.p,{children:"If you encounter issues with non-root path deployment:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Missing Assets"}),": Check that all asset URLs include the correct base path"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Navigation Issues"}),": Ensure all internal links include the base path"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Calls"}),": Verify that API calls are using the correct paths"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"404 Errors"}),": Check your reverse proxy configuration to ensure requests are being properly routed"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsx)(n.p,{children:"When deploying on a non-root path:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Some features may require additional configuration"}),"\n",(0,r.jsx)(n.li,{children:"Deep linking and sharing links may require special handling"}),"\n",(0,r.jsx)(n.li,{children:"SEO considerations may be different than with root deployments"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);